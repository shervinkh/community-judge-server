
Community Judge Server
======================

License: GPLv3 Or Later
Project Site: http://www.shervin.org
Contact: communityjudge@shervin.org Or shervinkh145@gmail.com
Note: This program is only runnable under GNU/Linux for now.

Compile Notes
=============

I've tried my best to make this source code compilable with both qt4 and qt5.
For compiling this you probably need to have qt and its development package on
some distros (qt-dev or something) either qt4 or qt5.
OpenSSL maybe needed as well because program uses Qt SSL Module.

First run "qmake" to make "Makefile" for building project.
Then run "make" to compile the whole project.
Then compile "ControlledRun" with the following command:
"gcc ControlledRun.c -o ControlledRun -O2"

Compilable with gcc>=4.6 or any standard compiler with c++0x (c++11) standard support.

For server to run correctly "ControlledRun", "run.sh", and "problems", "submits", "tmp"
folders provided in "Extras" folder should be present in its running directory.

Management Notes
================

1-"CommunityJudgeServer", "ControlledRun", "run.sh", and problems' "tester.out"
files should have executable permission.

2-All folders should be writable for user which runs the "CommunityJudgeServer".

3-Package "sudo" should be installed and be in "Path" to run submitted programs
under an unprivilaged user. If its not in "Path" edit run.sh

4-An unprivilaged user is needed to run submitted programs. Default user is "noone".
You should either create a user named "noone" using command "useradd noone" or use
another unprivilaged user by changing run.sh

5-For using sudo to run a submitted program under a unprivilaged user, you should
do one of the following things:

-Store password of the user which runs "CommunityJudgeServer" followed by a newline
in mypassword file.
In order to do that you can open a terminal switch to directory of 
'CommunityJudgeServer' file. Then type "cat > mypassword" then type your password
press enter and then Ctrl+D.

-Alternatively, You can tell sudo not to ask password when running program as the
unprivilaged user.
In order to do that you can add this rule to your sudoers file 
(edit using visudo command) "ALL ALL=(noone) NOPASSWD:ALL" .Replace noone with your
unprivilaged user name if you used another. If you did this alternative way you should
remove "cat mypassword | " from run.sh

6-You should run server in the following way:
./CommunityJudgeServer SERVER_PORT CONNECTION_TYPE
SERVER_PORT should be a unused port on server device and CONNECTION_TYPE should be
either ssl or tcp.
ssl uses secure connections between server and client, and tcp uses non-secure connections.

7-If you want to start server in ssl mode you should have "server.key" and "server.crt"
files in the directory of "CommunityJudgeServer" file. those files are ssl private key
and ssl certificate respectively. Note that your clients should have a copy of your
certificate in their "certs" folder in the directory of "CommunityJudgeClient" file.

8-If you don't know much about ssl and want to have a secure server, you can use
following command to make a self-signed ssl certificate:
"openssl req -x509 -newkey rsa:1024 -keyout server.key -nodes -days 365 -out server.crt"
You can change 1024 to your custom key length and 365 to your custom validity days.
You should use your IP Address (or Domain or whatever people use to connect to you)
as your certificate's common name property.
Note that if you want the best security you should purchase ssl certificate from 
a Certificate Provider instead of using a self-signed one.

9-Your problems should have files (1.in, 1.out, 2.in, 2.out, ..., n.in, n.out) 
as testcases, and a tester file named "tester.out"
tester.out takes 3 runtime arguments. First one is testcase's .in file, second one
is testcase's .out file, and the third one is output file generated by user submitted
program.
it should return 0 if output is correct and 1 otherwise.
All files of a problem should be placed in a folder in "problems" folder.

10-When you run server for first time it builds its database. Default username
and password are admin that you can change both of them from admin panel.

11-Do not delete submissions until you really have to. Deleting submissions 
does not update score system, So it can mess up score system.

12-In this version, every instance of client, every user, every ip address, 
can make only 1 connection to the server, Other connections will be dropped.

13- Do not set configs like server_timeout and max_packet_size to a non-appropriate
value so you (The admin) can not connect to server. If you did so, the only way to
fix is open database using 'sqlite3' manually and reset config values to a correct value.

14- Try not to modify database by hand using 'sqlite3'. You might forget to do something
that is essential for server.

15- This is the beta-1 version of program. Thus, it may have many bugs. Please report
them if you want me to fix them.
I published it to see how many users would use it.
If users exceed some bound I work more on the program. (e.g. Special Contest Area, etc.).
